(function(e){"use strict";var t=e.document,a=e.setTimeout||a,s=e.clearTimeout||s,n=e.setInterval||n,r=e.History=e.History||{};if(r.initHtml4!==undefined)throw Error("History.js HTML4 Support has already been loaded...");r.initHtml4=function(){return r.initHtml4.initialized!==undefined?!1:(r.initHtml4.initialized=!0,r.enabled=!0,r.savedHashes=[],r.isLastHash=function(e){var t,a=r.getHashByIndex();return t=e===a},r.isHashEqual=function(e,t){return e=encodeURIComponent(e).replace(/%25/g,"%"),t=encodeURIComponent(t).replace(/%25/g,"%"),e===t},r.saveHash=function(e){return r.isLastHash(e)?!1:(r.savedHashes.push(e),!0)},r.getHashByIndex=function(e){var t=null;return t=e===undefined?r.savedHashes[r.savedHashes.length-1]:0>e?r.savedHashes[r.savedHashes.length+e]:r.savedHashes[e]},r.discardedHashes={},r.discardedStates={},r.discardState=function(e,t,a){var s,n=r.getHashByState(e);return s={discardedState:e,backState:a,forwardState:t},r.discardedStates[n]=s,!0},r.discardHash=function(e,t,a){var s={discardedHash:e,backState:a,forwardState:t};return r.discardedHashes[e]=s,!0},r.discardedState=function(e){var t,a=r.getHashByState(e);return t=r.discardedStates[a]||!1},r.discardedHash=function(e){var t=r.discardedHashes[e]||!1;return t},r.recycleState=function(e){var t=r.getHashByState(e);return r.discardedState(e)&&delete r.discardedStates[t],!0},r.emulated.hashChange&&(r.hashChangeInit=function(){r.checkerFunction=null;var a,s,d,i,c="",o=Boolean(r.getHash());return r.isInternetExplorer()?(a="historyjs-iframe",s=t.createElement("iframe"),s.setAttribute("id",a),s.setAttribute("src","#"),s.style.display="none",t.body.appendChild(s),s.contentWindow.document.open(),s.contentWindow.document.close(),d="",i=!1,r.checkerFunction=function(){if(i)return!1;i=!0;var t=r.getHash(),a=r.getHash(s.contentWindow.document);return t!==c?(c=t,a!==t&&(d=a=t,s.contentWindow.document.open(),s.contentWindow.document.close(),s.contentWindow.document.location.hash=r.escapeHash(t)),r.Adapter.trigger(e,"hashchange")):a!==d&&(d=a,o&&""===a?r.back():r.setHash(a,!1)),i=!1,!0}):r.checkerFunction=function(){var t=r.getHash()||"";return t!==c&&(c=t,r.Adapter.trigger(e,"hashchange")),!0},r.intervalList.push(n(r.checkerFunction,r.options.hashChangeInterval)),!0},r.Adapter.onDomLoad(r.hashChangeInit)),r.emulated.pushState&&(r.onHashChange=function(t){var a,s=t&&t.newURL||r.getLocationHref(),n=r.getHashByUrl(s),d=null,i=null;return r.isLastHash(n)?(r.busy(!1),!1):(r.doubleCheckComplete(),r.saveHash(n),n&&r.isTraditionalAnchor(n)?(r.Adapter.trigger(e,"anchorchange"),r.busy(!1),!1):(d=r.extractState(r.getFullUrl(n||r.getLocationHref()),!0),r.isLastSavedState(d)?(r.busy(!1),!1):(i=r.getHashByState(d),(a=r.discardedState(d))?(r.getHashByIndex(-2)===r.getHashByState(a.forwardState)?r.back(!1):r.forward(!1),!1):(r.pushState(d.data,d.title,encodeURI(d.url),!1),!0))))},r.Adapter.bind(e,"hashchange",r.onHashChange),r.pushState=function(t,a,s,n){if(s=encodeURI(s).replace(/%25/g,"%"),r.getHashByUrl(s))throw Error("History.js does not support states with fragment-identifiers (hashes/anchors).");if(n!==!1&&r.busy())return r.pushQueue({scope:r,callback:r.pushState,args:arguments,queue:n}),!1;r.busy(!0);var d=r.createStateObject(t,a,s),i=r.getHashByState(d),c=r.getState(!1),o=r.getHashByState(c),h=r.getHash(),u=r.expectedStateId==d.id;return r.storeState(d),r.expectedStateId=d.id,r.recycleState(d),r.setTitle(d),i===o?(r.busy(!1),!1):(r.saveState(d),u||r.Adapter.trigger(e,"statechange"),r.isHashEqual(i,h)||r.isHashEqual(i,r.getShortUrl(r.getLocationHref()))||r.setHash(i,!1),r.busy(!1),!0)},r.replaceState=function(t,a,s,n){if(s=encodeURI(s).replace(/%25/g,"%"),r.getHashByUrl(s))throw Error("History.js does not support states with fragment-identifiers (hashes/anchors).");if(n!==!1&&r.busy())return r.pushQueue({scope:r,callback:r.replaceState,args:arguments,queue:n}),!1;r.busy(!0);var d=r.createStateObject(t,a,s),i=r.getHashByState(d),c=r.getState(!1),o=r.getHashByState(c),h=r.getStateByIndex(-2);return r.discardState(c,d,h),i===o?(r.storeState(d),r.expectedStateId=d.id,r.recycleState(d),r.setTitle(d),r.saveState(d),r.Adapter.trigger(e,"statechange"),r.busy(!1)):r.pushState(d.data,d.title,d.url,!1),!0}),r.emulated.pushState&&r.getHash()&&!r.emulated.hashChange&&r.Adapter.onDomLoad(function(){r.Adapter.trigger(e,"hashchange")}),undefined)},r.init!==undefined&&r.init()})(window);